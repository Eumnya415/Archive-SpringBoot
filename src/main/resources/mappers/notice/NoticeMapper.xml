<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace='com.sloop.archive.notice.mapper.NoticeMapper'>

    <!-- 공지사항 상단 고정 우선 목록 조회 -->
    <select id="getAllNoticePinnedFirst" resultType="com.sloop.archive.notice.domain.NoticeDTO">
        SELECT * FROM tb_notice
        WHERE delete_flag = 0
        ORDER BY pinned DESC, id DESC
    </select>

    <!-- ID로 공지사항 상세 조회 -->
    <select id="getNoticeById" parameterType="java.lang.Long" resultType="com.sloop.archive.notice.domain.NoticeDTO">
        SELECT * FROM tb_notice
        WHERE id = #{id}
        AND delete_flag = 0
    </select>

    <!-- 공지사항 등록 -->
    <insert id="insertNotice" parameterType="com.sloop.archive.notice.domain.NoticeDTO" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO tb_notice (user_id, title, content, views, regist_date, pinned)
        VALUES (#{userId}, #{title}, #{content}, #{views}, #{registDate}, #{pinned})
    </insert>

    <!-- 공지사항 수정 -->
    <update id="updateNotice" parameterType="com.sloop.archive.notice.domain.NoticeDTO">
        UPDATE tb_notice
        SET title = #{title},
            content = #{content},
            update_date = CURRENT_TIMESTAMP,
            update_flag = 1
        WHERE id = #{id}
    </update>

    <!-- 공지사항 삭제 -->
    <update id="deleteNotice" parameterType="java.lang.Long">
        UPDATE tb_notice
        SET delete_flag = 1,
            delete_date = CURRENT_TIMESTAMP
        WHERE id = #{id}
    </update>

</mapper>